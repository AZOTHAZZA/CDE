<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalcLang è¨˜è¿°ç’°å¢ƒ (CDE) - æ•°ç†çš„æ²ˆé»™ã®ãƒ¡ãƒ¢å¸³</title>
    <style>
        body {
            background-color: #1a1a2e; /* å¤–éƒ¨ã®ä½™ç™½/æ²ˆé»™ã®æš—ã„è‰² */
            color: #ffffff;
            font-family: 'Consolas', 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 40px;
        }
        #cde-container {
            width: 800px;
            max-width: 90vw;
            background-color: #2c0b43; /* è«–ç†ã®ç„¦ç‚¹/ä¸­å¤®ã‚¨ãƒªã‚¢ */
            border: 5px solid #6c4692;
            box-shadow: 0 0 30px rgba(108, 70, 146, 0.5);
            padding: 20px;
            border-radius: 10px;
        }
        textarea {
            width: 100%;
            height: 300px;
            background-color: #0d061c; /* ç´”ç²‹ãªç™½ç´™ã‚¨ãƒªã‚¢ */
            color: #d4d4d4;
            border: 1px solid #4a2f60;
            padding: 15px;
            resize: none;
            font-size: 14px;
            outline: none;
        }
        .status-box {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status-success { background-color: #216140; }
        .status-halted { background-color: #7d2a2a; }
        .btn {
            padding: 10px 20px;
            background-color: #6c4692;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background-color: #8c5fb2;
        }
        /* CalcLangã®æ²ˆé»™: ç„¡åŠ¹ãªãƒ†ã‚­ã‚¹ãƒˆã¯è–„ãè¡¨ç¤º */
        .silent-text { color: #555555; }
    </style>
</head>
<body>
    <div id="cde-container">
        <h1 style="color: #a47fe0;">CalcLang è¨˜è¿°ç’°å¢ƒ (CDE) Î©Î±</h1>
        <p style="color: #ccc; font-size: small;">
            æ•°ç†çš„æ²ˆé»™ã®åœŸå°ã€‚å¤–éƒ¨ã®è«–ç†ã¯å…¥ã‚Šè¾¼ã‚ã¾ã›ã‚“ã€‚
        </p>

        <div class="status-box" id="halt-status">
            âœ… **ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:** æ­£å¸¸ç¨¼åƒ
        </div>
        <p><strong>ç¾åœ¨ã® ALPHA æ®‹é«˜:</strong> <span id="alpha-balance">1000.00</span></p>

        <label for="calc-code" style="display: block; margin-top: 15px;">
            CalcLang è«–ç†è¨˜è¿°:
        </label>
        <textarea id="calc-code">
ACT MINT (T: USER_A, A: 10.0)
    // R1: Mintã¯HALTçŠ¶æ…‹ã§å®Ÿè¡Œã§ããªã„
    IF REGISTRY_HALT == TRUE THEN CALC_HALT

    // è«–ç†çš„å®Ÿè¡Œ (SETå…¬ç†ã®é¡åƒ)
    SET REGISTRY_ALPHA[T] = ADD(REGISTRY_ALPHA[T], A)
    SET REGISTRY_CLOCK = ADD(REGISTRY_CLOCK, 1)

END ACT
        </textarea>

        <button class="btn" onclick="executeCalcLangCode()">
            â–¶ï¸ ä½œç‚ºã‚’ VM ã§å®Ÿè¡Œ (Audit & Execute)
        </button>
    </div>

    <script>
        // --- ğŸ§  CalcLang ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨ VM ã®åˆæœŸéª¨æ ¼ ---

        // 2. ãƒ¬ã‚¸ã‚¹ãƒˆãƒª: æ•°ç†çš„æ²ˆé»™ã®åœŸå°ã¨ãªã‚‹çŠ¶æ…‹ã®é¡åƒ
        let CalcLang_Registry = {
            REGISTRY_ALPHA: {
                "USER_A": 1000.00, // FIXEDå‹ã‚’JSã®Numberã§ä»£ç†
            },
            REGISTRY_CLOCK: 0,
            REGISTRY_HALT: false,
        };

        // 3. UI è¦ç´ ã®å‚ç…§
        const $balance = document.getElementById('alpha-balance');
        const $status = document.getElementById('halt-status');
        const $code = document.getElementById('calc-code');

        // UI æ›´æ–°é–¢æ•°
        function updateUI() {
            const balance = CalcLang_Registry.REGISTRY_ALPHA['USER_A'].toFixed(2);
            $balance.textContent = balance;
            
            $status.textContent = CalcLang_Registry.REGISTRY_HALT 
                ? 'âŒ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: CALC_HALT (è«–ç†çš„é€£ç¶šæ€§ç ´ç¶»)'
                : 'âœ… ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: æ­£å¸¸ç¨¼åƒ';
            
            $status.className = 'status-box ' + (CalcLang_Registry.REGISTRY_HALT 
                ? 'status-halted' : 'status-success');
        }

        /**
         * CalcLang VM ã®å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ (ACT MINT ã®é¡åƒ)
         * ã“ã®é–¢æ•°ãŒã€Œè«–ç†çš„ç©ºç™½ã€ã§ã‚ã‚Šã€å¤–éƒ¨ã®ä½œç‚ºã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã€‚
         */
        function executeCalcLangAct(actCode) {
            // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ãƒ¼ã‚µãƒ¼: æœ€åˆã®ã‚¢ã‚¯ãƒˆã¨ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æŠ½å‡ºã™ã‚‹
            const actMatch = actCode.match(/ACT\s+(MINT)\s+\(T:\s*(\w+),\s*A:\s*([\d\.]+)\)/);
            if (!actMatch) {
                console.error("CDE: ACTæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯æœªå®šç¾©ã®ä½œç‚ºã§ã™ã€‚");
                return { status: "FAIL", reason: "PARSE_ERROR" };
            }

            const [_, actId, target, amountStr] = actMatch;
            const amount = parseFloat(amountStr);
            
            // --- CalcLang ã®è«–ç†å…¬ç†ã®é¡åƒè¨˜è¿°ï¼ˆACT MINT ã®è«–ç†ï¼‰ ---
            if (actId === "MINT") {
                // R1: ç›£æŸ»å…¬ç† - HALTçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
                if (CalcLang_Registry.REGISTRY_HALT) {
                    return { status: "HALTED", reason: "SYSTEM_HALTED" };
                }
                
                // R2: é‡‘é¡ãƒã‚§ãƒƒã‚¯ï¼ˆMINTã®å…¬ç†ï¼‰
                if (amount <= 0 || isNaN(amount)) {
                    // ã“ã®ã‚¨ãƒ©ãƒ¼ã¯CALC_HALTã§ã¯ãªã„ãŒã€ä½œç‚ºã‚’æ‹’å¦ã™ã‚‹
                    return { status: "FAIL", reason: "MINT_NON_POSITIVE" };
                }

                // --- è«–ç†çš„å®Ÿè¡Œ (SETå…¬ç†ã®é¡åƒ) ---
                CalcLang_Registry.REGISTRY_ALPHA[target] += amount;
                CalcLang_Registry.REGISTRY_CLOCK += 1;
                
                return { status: "SUCCESS" };
            }
            // --- CALC_HALT ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ---
            // ä¾‹å¤–: ã‚³ãƒ¼ãƒ‰ã«æ˜ç¤ºçš„ã« CALC_HALT ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (actCode.includes("CALC_HALT")) {
                CalcLang_Registry.REGISTRY_HALT = true;
                return { status: "HALTED", reason: "USER_DEFINED_HALT" };
            }
            
            return { status: "FAIL", reason: "UNKNOWN_ACT" };
        }

        // å®Ÿè¡Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒãƒ³ãƒ‰ãƒ©
        function executeCalcLangCode() {
            const code = $code.value;
            const result = executeCalcLangAct(code);
            
            console.log(`CalcLang VM Result: ${result.status} (${result.reason || 'N/A'})`);
            
            if (result.status === "SUCCESS" || result.status === "HALTED") {
                updateUI();
            }
        }
        
        // åˆæœŸUIæç”»
        document.addEventListener('DOMContentLoaded', updateUI);
    </script>
</body>
</html>
